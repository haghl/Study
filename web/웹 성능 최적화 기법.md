# 웹 성능 최적화 기법  

## HTTP 최적화

## 웹 성능과 웹 최적화란?  

### 1. 웹 성능이란?

웹 성능이란 웹 사이트의 기능이나 내용을 의미하는 것이 아니라. 콘텐츠가 신속하게 전달되어 사용자가 원하는 서비스를  빠르게 전달받을 수 있도록 하는 시스템들의 성능을 의미합니다.  

즉 웹 성능은  브라우저 주소창에 도메인 주소를 입력하여 해당 사이트로 접속하고 웹 페이지가 로딩되어 내용을 볼 수 있을 때까지 걸린 시간, 웹 로딩 시간을 말합니다.

### 2. 웹 최적화란?

웹 최적화란 최고의 웹 성능을 구현하기 위해 최고의 조건을 만드는 다양한 노력을 의미합니다.



## 목차

### 1. HTTP의 발전

### 2. HTTP 요청 수 줄이기



## 1. HTTP의 발전

##### TCP, UDP

TCP : 신뢰성을 위해 3-way handshake 방식으로 작동한다.

<img src="https://user-images.githubusercontent.com/66556683/142372518-c1b7c7fa-d141-4baa-8ffc-6d54e4d53244.png" alt="TCP" style="margin:0; zoom: 80%" />  

UDP : 신뢰성보다는 데이터를 일방적으로 보내기만 함.

<img src="https://user-images.githubusercontent.com/66556683/142372647-68a7a752-7806-42b5-9714-09b675a00bc9.png" alt="UDP" style="margin: 0;zoom:150%;" />  

차이  

TCP는 신뢰성은 높으나 전송속도가 UDP에 비해 떨어진다.

반대로 UDP는 신뢰성은 떨어지나 전송속도가 빠르다.



##### HTTP/0.9

초기 HTTP에는 버전 정보가 없었으나 이후 구분을 위해 0.9버전이라고 불리게 됨.

요청은 단일 라인으로 구성되며 가능한 메서드로 GET이 유일했다.

```
GET /mypage.html
```

```
<HTML>
A very simple HTML page
</HTML>
```



##### HTTP/1.0

HTTP/0.9 버전의 제한성을 조금 더 확장해 주었고 헤더가 생겨서 버전을 알려주고 응답에는 상태코드와 또 Content-Type이라는 헤더 덕분에 HTML파일 외에도 다양한 문서들을 전송할 수 있게 되었다.

<img src="https://user-images.githubusercontent.com/66556683/142368090-dc32908f-7e64-4f7c-8a05-0a88bed36a55.png" alt="http1 0" style="margin:0;" />

하지만 HTTP/1.0버전까지 Connection 하나당 응답과 요청 하나만 처리가 가능했음.

그래서 매번 요청이 생길 때 마다 성능의 저하가 일어났고 그로인해 서버의 부하 비용도 상승하게 됨.



##### HTTP/1.1

HTTP 첫 번째 공식 표준 버전이다.

**Persistent Connection** 방식 도입 지정한 timeout동안 커넥션을 닫지 않는 방식.

<img src="https://user-images.githubusercontent.com/66556683/142378114-470d9767-0e6e-4655-87e7-bb5244d3c5ac.png" alt="http1 1" style="margin:0; zoom:150%;" />

하지만 첫 번째 요청에 대한 응답이 있기 전까지 다음 요청에 지연이 발생을 하는 문제가 생김.

**Pipelining** : 하나의 커넥션에서 응답을 기다리지 않고 순차적인 여러 요청을 연속적으로 보내 그 순서에 맞춰 응답을 받는 방식으로 지연 시간을 줄이는 방법.

| <img src="https://user-images.githubusercontent.com/66556683/142380004-27a363f2-1180-492b-bc73-645b04390918.png" alt="pipelining" style="zoom:70%" /> | <img src="https://user-images.githubusercontent.com/66556683/142517727-038b86d7-7aec-432d-9143-66b9a9d020db.png" alt="HOL" style="zoom: 100%" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: |

파이프라이닝도 **HOL(Head Of Line Blocking)**이 발생 첫번째 요청의 응답시간이 길어지면 다음 요청의 응답도 지연되는 문제가 발생.

또한 연속된 요청시 헤더의 값이 중복되어 쓸데없는 비용 발생하게 됨.



##### HTTP/2

2015년 등장함 HTTP/2 버전의 큰 목표는 클라이언트와 서버가 콘텐츠를 주고 받는 시간을 줄이고, 서버 응답이 느린 콘텐츠가 다른 정상적인 콘텐츠의 전달을 방해하지 않도록 하는 것입니다.

이를 위해 기존 text 방식의 프로토콜을 **bonary frame(이진 프레임)** 방식으로 바꾸어 프로토콜이 더욱 유연해지고 가벼워지게 만듦.

<img src="https://user-images.githubusercontent.com/66556683/142551215-359a4859-838b-4df1-818a-0aabb276dc10.png" alt="header2" style="margin:0; zoom:70%;" />



- **프레임(Frame)** : HTTP/2 통신상 제일 작은 정보 단위이며 헤더나 데이터 중 하나입니다.
- **메시지(Message)** : HTTP/1.1 마찬가지로 요청 혹은 응답 단위이며 다수의 프레임으로 이루어져 있습니다.
- **스트림(Stream)** : 클라이언트와 서버 사이 맺어진 연결을 통하여 양방향으로 주고받는 하나 혹은 복수의 메시지 입니다.<img src="https://user-images.githubusercontent.com/66556683/142552096-fca3bd35-e9f2-4bb9-a566-331b43a0284c.png" alt="stream" style="zoom:70%;" />

**멀티플렉싱(Multiplexing)** : 하나의 TCP 연결상에서 다수의 클라이언트 요청과 서버의 응답이 비동기 방식으로 이루어지는 기술.

=> 멀티 플렉싱으로 인해 **HOL(Head Of Line Blocking)**이 해결됨.

  <img src="https://user-images.githubusercontent.com/66556683/142552183-f9c66b31-b495-46fb-a8b2-cdffe19df915.png" alt="stream2" style="zoom:150%;" />



**HPACK : 헤더 압축(Header Compression)**

클라이언트와 서버 사이에 가상 테이블을 만들어서 동일하고 중복되는 헤더 값들을 테이블에 저장하고 인덱스만 전달하고 중복되지 않은 데이터들은

허프만 알고리즘 방식으로 인코딩 하여 압축하는 방식.

=> 헤더의 크기가 약 85% 줄어들어 페이지 로드 시간이 감소.

| <img src="https://user-images.githubusercontent.com/66556683/142521266-5667a366-5dfd-4dee-81f5-0dc84b6244ad.png" alt="header" style="margin:0;zoom:60%;"/> | <img alt="pressing" src="https://user-images.githubusercontent.com/66556683/142565340-743e0972-08a4-4808-ac23-2e65426dab8c.png"  style="margin:0;zoom:150%;" /> |
| ------------------------------------------------------------ | :----------------------------------------------------------: |



**서버 푸시(Server Push)** : 클라이언트가 특정 콘텐츠를 요청하면 서버는 이후 추가될 요청을 미리 예상하고 요청 없이도 응답하는 기능

<img src="https://user-images.githubusercontent.com/66556683/142573902-8e624f9a-c216-48f3-8ba9-7a35d6657d32.png" alt="push" style="zoom:60%;" />

##### HTTP/3

HTTP/0.9부터 HTTP/2까지 TCP 프로토콜을 이용해왔다.

TCP는 성능보다는 기능에 초점을 두어 멀티 미디어 콘텐츠를 다양한 기기에 빠르게 전달해야 하는 상황에서 TCP의 한계를 극복하고 최적화 하는 것이 많은 기업들의 도전 과제 였다.

**QUIC(Quick UDP Internet Connections)** : TCP, UDP 와 같은 전송 계층의 프로토콜로 구글에서 2013년에 공개했다 현재 구글 관련 제품 대부분의 기본 프로토콜로 사용된다.



## 2. HTTP 요청 수 줄이기

#### 1) 콘텐츠 줄이는 방법
